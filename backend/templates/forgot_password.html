<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Samarth Aushadhalay</title>
    <!--link to CSS-->
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/login.css') }}">

    <!-- Box Icon -->
    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
</head>
<body>
    <!-- Navbar -->
    <header>
        <!-- Profile -->
        <div class="profile">
          <img src="{{ url_for('static', filename='img/logo_srividya_(1).png') }}" alt="">
          <span>SAMARTH AUSHADHALAY</span>
        </div>
          <!-- menu icon -->
          <div class="bx bx-menu" id="menu-icon"></div>
          <!-- Nav List -->
           <ul class="navbar">
              <li><a href="index.html">Home</a></li>
              <li><a href="products.html">Products</a></li>
              <li><a href="about.html">About</a></li>
              <li><a href="cart.html">Cart</a></li>
              <li><a href="order_history.html">My Orders</a></li>
           </ul>
           <!-- Header Icon -->
            <div class="header-icons">
              {% if session.get('username') %}
              <div class="logged-in-user-info">
                <span>Hello, {{ session['username'] }}</span>
                <a href="#" id="logout-icon" onclick="event.preventDefault(); document.getElementById('logout-form').submit();"><i class='bx bx-log-out'></i></a>
                <form id="logout-form" action="{{ url_for('auth.logout') }}" method="POST" style="display: none;"></form>
              </div>
              {% else %}
              <a href="login.html" class="user-icon-active"><i class='bx bx-user' id="user-icon"></i></a>
              {% endif %}
              <i class='bx bx-menu' id="menu-icon"></i>

            </div>
            
      </header>
       <!-- User -->
       <section class="user" id="user" style="
          background-image: url('{{ url_for('static', filename='img/login.jpg') }}');
          background-repeat: no-repeat;
          background-size: cover;
          background-position: center;
       ">
        <div class="user-text">
        <h2>Forgot Password</h2>
        <form id="forgotPasswordForm">
            <input type="text" id="email_or_username" name="email_or_username" placeholder="Enter your username or email" required>
            <input type="submit" value="Request Reset Link" class="login-btn">
        </form>
        <p id="message" style="color: red; text-align: center; margin-top: 10px;"></p>
        <p>Remember your password? <a href="login.html">Login</a></p>
        </div>
      </section>

      <script>
        document.getElementById('forgotPasswordForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const emailOrUsername = document.getElementById('email_or_username').value.trim();
            const messageElement = document.getElementById('message');
            messageElement.textContent = ''; // Clear previous messages

            try {
                const response = await fetch('/auth/forgot_password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identifier: emailOrUsername })
                });

                const data = await response.json();

                if (response.ok && data.redirect_url) {
                    // Redirect to the URL provided by the backend
                    window.location.href = data.redirect_url;
                } else if (response.ok) {
                    // Fallback, if for some reason redirect_url is not in data
                    messageElement.style.color = 'green';
                    messageElement.textContent = data.message || 'Processing your request...';
                }
                else {
                    messageElement.style.color = 'red';
                    messageElement.textContent = 'Error: ' + (data.message || response.statusText);
                }
            } catch (err) {
                console.error('Forgot password request error:', err);
                messageElement.style.color = 'red';
                messageElement.textContent = 'An error occurred. Please try again.';
            }
        });
      </script>

</body>
</html>